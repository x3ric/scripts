#!/bin/zsh -i
# Pentest Tmux
if [[ $# -ne 2 ]]; then
  echo -e "Usage: pentest <server_ip> <path>\n like --> pentest 192.168.1.1 $HOME/Documents/Projects/CTF/HTB"
  exit 1
fi
server_ip=$1
session_name="htb_${server_ip//./_}"
if tmux has-session -t "$session_name" 2>/dev/null; then
  echo "[-] Duplicate session: $session_name"
else
  echo "[+] Creating tmux session: $session_name"
  \tmux new-session -d -s "$session_name" -n "Enumeration" -c "$2"
  echo "[+] Running Nmap scan on $server_ip"
  \tmux send-keys -t "${session_name}:Enumeration" "nmap-full $server_ip" C-m

  #echo "[+] Creating additional window for http server"
  #\tmux new-window -t "$session_name" -n "HTTP-Server" -c "$2"
  #\tmux send-keys -t "${session_name}:HTTP-Server" "www" C-m

  echo "[+] Creating additional window for Shell"
  \tmux new-window -t "$session_name" -n "Shell" -c "$2"
  \tmux send-keys -t "${session_name}:Shell" "cd $2" C-m
fi
\tmux attach-session -t "$session_name"
