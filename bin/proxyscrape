#!/bin/bash
# Proxy letcher and tester
proxytest() { # Proxy tester
    local ip=$(echo "$1" | rev | cut -d':' -f2 | rev | sed 's|//||')
    local port=$(echo "$1" | cut -d':' -f3)
    if [[ $1 == *"socks5"* ]]; then
        local type="socks5"
    elif [[ $1 == *"socks4"* ]]; then
        local type="socks4"
    else
        local type="http"
    fi
    local info=$(curl --connect-timeout 5 -x "$1" -s -w '\n%{speed_download}' "https://ipinfo.io")
    if [[ ! -z $info ]]; then
        local speed=$(echo "$info" | sed -n '13p' )
        local country=$(echo "$info" | grep -o '"country": *"[^"]*"' | grep -o '"[^"]*"$' | tr -d '"')
        if [[ ! -z $country ]]; then
            case $country in
                "AF") country+="ðŸ‡¦ðŸ‡«";;
                "AX") country+="ðŸ‡¦ðŸ‡½";;
                "AL") country+="ðŸ‡¦ðŸ‡±";;
                "DZ") country+="ðŸ‡©ðŸ‡¿";;
                "AS") country+="ðŸ‡¦ðŸ‡¸";;
                "AD") country+="ðŸ‡¦ðŸ‡©";;
                "AO") country+="ðŸ‡¦ðŸ‡´";;
                "AI") country+="ðŸ‡¦ðŸ‡®";;
                "AQ") country+="ðŸ‡¦ðŸ‡¶";;
                "AG") country+="ðŸ‡¦ðŸ‡¬";;
                "AR") country+="ðŸ‡¦ðŸ‡·";;
                "AM") country+="ðŸ‡¦ðŸ‡²";;
                "AW") country+="ðŸ‡¦ðŸ‡¼";;
                "AU") country+="ðŸ‡¦ðŸ‡º";;
                "AT") country+="ðŸ‡¦ðŸ‡¹";;
                "AZ") country+="ðŸ‡¦ðŸ‡¿";;
                "BS") country+="ðŸ‡§ðŸ‡¸";;
                "BH") country+="ðŸ‡§ðŸ‡­";;
                "BD") country+="ðŸ‡§ðŸ‡©";;
                "BB") country+="ðŸ‡§ðŸ‡§";;
                "BY") country+="ðŸ‡§ðŸ‡¾";;
                "BE") country+="ðŸ‡§ðŸ‡ª";;
                "BZ") country+="ðŸ‡§ðŸ‡¿";;
                "BJ") country+="ðŸ‡§ðŸ‡¯";;
                "BM") country+="ðŸ‡§ðŸ‡²";;
                "BT") country+="ðŸ‡§ðŸ‡¹";;
                "BO") country+="ðŸ‡§ðŸ‡´";;
                "BA") country+="ðŸ‡§ðŸ‡¦";;
                "BW") country+="ðŸ‡§ðŸ‡¼";;
                "BV") country+="ðŸ‡§ðŸ‡»";;
                "BR") country+="ðŸ‡§ðŸ‡·";;
                "IO") country+="ðŸ‡®ðŸ‡´";;
                "BN") country+="ðŸ‡§ðŸ‡³";;
                "BG") country+="ðŸ‡§ðŸ‡¬";;
                "BF") country+="ðŸ‡§ðŸ‡«";;
                "BI") country+="ðŸ‡§ðŸ‡®";;
                "KH") country+="ðŸ‡°ðŸ‡­";;
                "CM") country+="ðŸ‡¨ðŸ‡²";;
                "CA") country+="ðŸ‡¨ðŸ‡¦";;
                "CV") country+="ðŸ‡¨ðŸ‡»";;
                "KY") country+="ðŸ‡°ðŸ‡¾";;
                "CF") country+="ðŸ‡¨ðŸ‡«";;
                "TD") country+="ðŸ‡¹ðŸ‡©";;
                "CL") country+="ðŸ‡¨ðŸ‡±";;
                "CN") country+="ðŸ‡¨ðŸ‡³";;
                "CX") country+="ðŸ‡¨ðŸ‡½";;
                "CC") country+="ðŸ‡¨ðŸ‡¨";;
                "CO") country+="ðŸ‡¨ðŸ‡´";;
                "KM") country+="ðŸ‡°ðŸ‡²";;
                "CG") country+="ðŸ‡¨ðŸ‡¬";;
                "CD") country+="ðŸ‡¨ðŸ‡©";;
                "CK") country+="ðŸ‡¨ðŸ‡°";;
                "CR") country+="ðŸ‡¨ðŸ‡·";;
                "CI") country+="ðŸ‡¨ðŸ‡®";;
                "HR") country+="ðŸ‡­ðŸ‡·";;
                "CU") country+="ðŸ‡¨ðŸ‡º";;
                "CY") country+="ðŸ‡¨ðŸ‡¾";;
                "CZ") country+="ðŸ‡¨ðŸ‡¿";;
                "DK") country+="ðŸ‡©ðŸ‡°";;
                "DJ") country+="ðŸ‡©ðŸ‡¯";;
                "DM") country+="ðŸ‡©ðŸ‡²";;
                "DO") country+="ðŸ‡©ðŸ‡´";;
                "EC") country+="ðŸ‡ªðŸ‡¨";;
                "EG") country+="ðŸ‡ªðŸ‡¬";;
                "SV") country+="ðŸ‡¸ðŸ‡»";;
                "GQ") country+="ðŸ‡¬ðŸ‡¶";;
                "ER") country+="ðŸ‡ªðŸ‡·";;
                "EE") country+="ðŸ‡ªðŸ‡ª";;
                "ET") country+="ðŸ‡ªðŸ‡¹";;
                "FK") country+="ðŸ‡«ðŸ‡°";;
                "FO") country+="ðŸ‡«ðŸ‡´";;
                "FJ") country+="ðŸ‡«ðŸ‡¯";;
                "FI") country+="ðŸ‡«ðŸ‡®";;
                "FR") country+="ðŸ‡«ðŸ‡·";;
                "GF") country+="ðŸ‡¬ðŸ‡«";;
                "PF") country+="ðŸ‡µðŸ‡«";;
                "TF") country+="ðŸ‡¹ðŸ‡«";;
                "GA") country+="ðŸ‡¬ðŸ‡¦";;
                "GM") country+="ðŸ‡¬ðŸ‡²";;
                "GE") country+="ðŸ‡¬ðŸ‡ª";;
                "DE") country+="ðŸ‡©ðŸ‡ª";;
                "GH") country+="ðŸ‡¬ðŸ‡­";;
                "GI") country+="ðŸ‡¬ðŸ‡®";;
                "GR") country+="ðŸ‡¬ðŸ‡·";;
                "GL") country+="ðŸ‡¬ðŸ‡±";;
                "GD") country+="ðŸ‡¬ðŸ‡©";;
                "GP") country+="ðŸ‡¬ðŸ‡µ";;
                "GU") country+="ðŸ‡¬ðŸ‡º";;
                "GT") country+="ðŸ‡¬ðŸ‡¹";;
                "GG") country+="ðŸ‡¬ðŸ‡¬";;
                "GN") country+="ðŸ‡¬ðŸ‡³";;
                "GW") country+="ðŸ‡¬ðŸ‡¼";;
                "GY") country+="ðŸ‡¬ðŸ‡¾";;
                "HT") country+="ðŸ‡­ðŸ‡¹";;
                "HM") country+="ðŸ‡­ðŸ‡²";;
                "VA") country+="ðŸ‡»ðŸ‡¦";;
                "HN") country+="ðŸ‡­ðŸ‡³";;
                "HK") country+="ðŸ‡­ðŸ‡°";;
                "HU") country+="ðŸ‡­ðŸ‡º";;
                "IS") country+="ðŸ‡®ðŸ‡¸";;
                "IN") country+="ðŸ‡®ðŸ‡³";;
                "ID") country+="ðŸ‡®ðŸ‡©";;
                "IR") country+="ðŸ‡®ðŸ‡·";;
                "IQ") country+="ðŸ‡®ðŸ‡¶";;
                "IE") country+="ðŸ‡®ðŸ‡ª";;
                "IM") country+="ðŸ‡®ðŸ‡²";;
                "IL") country+="ðŸ‡®ðŸ‡±";;
                "IT") country+="ðŸ‡®ðŸ‡¹";;
                "JM") country+="ðŸ‡¯ðŸ‡²";;
                "JP") country+="ðŸ‡¯ðŸ‡µ";;
                "JE") country+="ðŸ‡¯ðŸ‡ª";;
                "JO") country+="ðŸ‡¯ðŸ‡´";;
                "KZ") country+="ðŸ‡°ðŸ‡¿";;
                "KE") country+="ðŸ‡°ðŸ‡ª";;
                "KI") country+="ðŸ‡°ðŸ‡®";;
                "KP") country+="ðŸ‡°ðŸ‡µ";;
                "KR") country+="ðŸ‡°ðŸ‡·";;
                "KW") country+="ðŸ‡°ðŸ‡¼";;
                "KG") country+="ðŸ‡°ðŸ‡¬";;
                "LA") country+="ðŸ‡±ðŸ‡¦";;
                "LV") country+="ðŸ‡±ðŸ‡»";;
                "LB") country+="ðŸ‡±ðŸ‡§";;
                "LS") country+="ðŸ‡±ðŸ‡¸";;
                "LR") country+="ðŸ‡±ðŸ‡·";;
                "LY") country+="ðŸ‡±ðŸ‡¾";;
                "LI") country+="ðŸ‡±ðŸ‡®";;
                "LT") country+="ðŸ‡±ðŸ‡¹";;
                "LU") country+="ðŸ‡±ðŸ‡º";;
                "MO") country+="ðŸ‡²ðŸ‡´";;
                "MK") country+="ðŸ‡²ðŸ‡°";;
                "MG") country+="ðŸ‡²ðŸ‡¬";;
                "MW") country+="ðŸ‡²ðŸ‡¼";;
                "MY") country+="ðŸ‡²ðŸ‡¾";;
                "MV") country+="ðŸ‡²ðŸ‡»";;
                "ML") country+="ðŸ‡²ðŸ‡±";;
                "MT") country+="ðŸ‡²ðŸ‡¹";;
                "MH") country+="ðŸ‡²ðŸ‡­";;
                "MQ") country+="ðŸ‡²ðŸ‡¶";;
                "MR") country+="ðŸ‡²ðŸ‡·";;
                "MU") country+="ðŸ‡²ðŸ‡º";;
                "YT") country+="ðŸ‡¾ðŸ‡¹";;
                "MX") country+="ðŸ‡²ðŸ‡½";;
                "FM") country+="ðŸ‡«ðŸ‡²";;
                "MD") country+="ðŸ‡²ðŸ‡©";;
                "MC") country+="ðŸ‡²ðŸ‡¨";;
                "MN") country+="ðŸ‡²ðŸ‡³";;
                "ME") country+="ðŸ‡²ðŸ‡ª";;
                "MS") country+="ðŸ‡²ðŸ‡¸";;
                "MA") country+="ðŸ‡²ðŸ‡¦";;
                "MZ") country+="ðŸ‡²ðŸ‡¿";;
                "MM") country+="ðŸ‡²ðŸ‡²";;
                "NA") country+="ðŸ‡³ðŸ‡¦";;
                "NR") country+="ðŸ‡³ðŸ‡·";;
                "NP") country+="ðŸ‡³ðŸ‡µ";;
                "NL") country+="ðŸ‡³ðŸ‡±";;
                "NC") country+="ðŸ‡³ðŸ‡¨";;
                "NZ") country+="ðŸ‡³ðŸ‡¿";;
                "NI") country+="ðŸ‡³ðŸ‡®";;
                "NE") country+="ðŸ‡³ðŸ‡ª";;
                "NG") country+="ðŸ‡³ðŸ‡¬";;
                "NU") country+="ðŸ‡³ðŸ‡º";;
                "NF") country+="ðŸ‡³ðŸ‡«";;
                "MP") country+="ðŸ‡²ðŸ‡µ";;
                "NO") country+="ðŸ‡³ðŸ‡´";;
                "OM") country+="ðŸ‡´ðŸ‡²";;
                "PK") country+="ðŸ‡µðŸ‡°";;
                "PW") country+="ðŸ‡µðŸ‡¼";;
                "PS") country+="ðŸ‡µðŸ‡¸";;
                "PA") country+="ðŸ‡µðŸ‡¦";;
                "PG") country+="ðŸ‡µðŸ‡¬";;
                "PY") country+="ðŸ‡µðŸ‡¾";;
                "PE") country+="ðŸ‡µðŸ‡ª";;
                "PH") country+="ðŸ‡µðŸ‡­";;
                "PN") country+="ðŸ‡µðŸ‡³";;
                "PL") country+="ðŸ‡µðŸ‡±";;
                "PT") country+="ðŸ‡µðŸ‡¹";;
                "PR") country+="ðŸ‡µðŸ‡·";;
                "QA") country+="ðŸ‡¶ðŸ‡¦";;
                "RE") country+="ðŸ‡·ðŸ‡ª";;
                "RO") country+="ðŸ‡·ðŸ‡´";;
                "RU") country+="ðŸ‡·ðŸ‡º";;
                "RW") country+="ðŸ‡·ðŸ‡¼";;
                "BL") country+="ðŸ‡§ðŸ‡±";;
                "SH") country+="ðŸ‡¸ðŸ‡­";;
                "KN") country+="ðŸ‡°ðŸ‡³";;
                "LC") country+="ðŸ‡±ðŸ‡¨";;
                "MF") country+="ðŸ‡²ðŸ‡«";;
                "PM") country+="ðŸ‡µðŸ‡²";;
                "VC") country+="ðŸ‡»ðŸ‡¨";;
                "WS") country+="ðŸ‡¼ðŸ‡¸";;
                "SM") country+="ðŸ‡¸ðŸ‡²";;
                "ST") country+="ðŸ‡¸ðŸ‡¹";;
                "SA") country+="ðŸ‡¸ðŸ‡¦";;
                "SN") country+="ðŸ‡¸ðŸ‡³";;
                "RS") country+="ðŸ‡·ðŸ‡¸";;
                "SC") country+="ðŸ‡¸ðŸ‡½";;
                "SK") country+="ðŸ‡¸ðŸ‡°";;
                "SI") country+="ðŸ‡¸ðŸ‡®";;
                "SB") country+="ðŸ‡¸ðŸ‡§";;
                "SO") country+="ðŸ‡¸ðŸ‡´";;
                "ZA") country+="ðŸ‡¿ðŸ‡¦";;
                "GS") country+="ðŸ‡¬ðŸ‡¸";;
                "SS") country+="ðŸ‡¸ðŸ‡¸";;
                "ES") country+="ðŸ‡ªðŸ‡¸";;
                "LK") country+="ðŸ‡±ðŸ‡°";;
                "SD") country+="ðŸ‡¸ðŸ‡©";;
                "SR") country+="ðŸ‡¸ðŸ‡·";;
                "SJ") country+="ðŸ‡¸ðŸ‡¯";;
                "SZ") country+="ðŸ‡¸ðŸ‡¿";;
                "SE") country+="ðŸ‡¸ðŸ‡ª";;
                "CH") country+="ðŸ‡¨ðŸ‡­";;
                "SY") country+="ðŸ‡¸ðŸ‡¾";;
                "TW") country+="ðŸ‡¹ðŸ‡¼";;
                "TJ") country+="ðŸ‡¹ðŸ‡¯";;
                "TZ") country+="ðŸ‡¹ðŸ‡¿";;
                "TH") country+="ðŸ‡¹ðŸ‡­";;
                "TL") country+="ðŸ‡¹ðŸ‡±";;
                "TG") country+="ðŸ‡¹ðŸ‡¬";;
                "TK") country+="ðŸ‡¹ðŸ‡°";;
                "TO") country+="ðŸ‡¹ðŸ‡´";;
                "TT") country+="ðŸ‡¹ðŸ‡¹";;
                "TN") country+="ðŸ‡¹ðŸ‡³";;
                "TR") country+="ðŸ‡¹ðŸ‡·";;
                "TM") country+="ðŸ‡¹ðŸ‡²";;
                "TC") country+="ðŸ‡¹ðŸ‡¨";;
                "TV") country+="ðŸ‡¹ðŸ‡»";;
                "UG") country+="ðŸ‡ºðŸ‡¬";;
                "UA") country+="ðŸ‡ºðŸ‡¦";;
                "AE") country+="ðŸ‡¦ðŸ‡ª";;
                "GB") country+="ðŸ‡¬ðŸ‡§";;
                "US") country+="ðŸ‡ºðŸ‡¸";;
                "UM") country+="ðŸ‡ºðŸ‡²";;
                "UY") country+="ðŸ‡ºðŸ‡¾";;
                "UZ") country+="ðŸ‡ºðŸ‡¿";;
                "VU") country+="ðŸ‡»ðŸ‡º";;
                "VE") country+="ðŸ‡»ðŸ‡ª";;
                "VN") country+="ðŸ‡»ðŸ‡³";;
                "VG") country+="ðŸ‡»ðŸ‡¬";;
                "VI") country+="ðŸ‡»ðŸ‡®";;
                "WF") country+="ðŸ‡¼ðŸ‡«";;
                "EH") country+="ðŸ‡ªðŸ‡­";;
                "YE") country+="ðŸ‡¾ðŸ‡ª";;
                "XK") country+="ðŸ‡½ðŸ‡°";;
                "ZM") country+="ðŸ‡¿ðŸ‡²";;
                "ZW") country+="ðŸ‡¿ðŸ‡¼";;
                *) country+="ðŸŒ";;
            esac
        fi
        local realip=$(echo "$info" | grep -o '"ip": *"[^"]*"' | grep -o '"[^"]*"$' | tr -d '"')
        local results="$HOME/.cache/$type.txt"
        [[ ! -f $results ]] && touch $results
        [[ ! -f "$HOME/.cache/proxylist.txt" ]] && touch "$HOME/.cache/proxylist.txt"
        if ! grep -qF "$ip:$port" "$results" && [[ ! -z $country ]]; then
            echo "$ip:$port" >> "$HOME/.cache/proxylist.txt"
            echo "$ip:$port" >> "$results"
            if [ -z "$speed" ]; then
                speed="<50"
            fi
            counter=$(< "/tmp/proxy-counter.txt")
            while [ "$counter" == "" ]; do
                sleep 1
            done
            local hided=""
            if [[ $realip != $ip ]]; then
                hided="Hided"
            fi
            echo -e "$(printf '\033[1;38m%-5s\033[0m' "$counter")/$(printf '\033[1;38m%-5s\033[0m' "$proxies") $(printf '\033[1;34m%-21s\033[0m' "$ip:$port") $(printf '\033[1;32m%-8s\033[0m' "$country") $(printf '\033[1;31m%-10s\033[0m' "Speed[$speed]") \033[1;36mSaved in $results\033[0m \033[1;37mFinded $(wc --lines < $HOME/.cache/proxylist.txt | awk '{print $1}')\033[0m $(printf '\033[1;38m%-10s\033[0m' "$hided")"
            return 0
        fi
    else
        return 1
    fi
}
urls=(
    ### Http Https
    "https://api.proxyscrape.com/v3/free-proxy-list/get?request=getproxies&protocol=http&proxy_format=ipport&format=text&timeout=20000"
    "https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/http.txt"
    "https://raw.githubusercontent.com/MuRongPIG/Proxy-Master/main/http.txt"
    "https://raw.githubusercontent.com/mmpx12/proxy-list/master/https.txt"
    "https://raw.githubusercontent.com/mmpx12/proxy-list/master/http.txt"
    ### Socks 4
    "https://api.proxyscrape.com/v3/free-proxy-list/get?request=getproxies&protocol=socks4&proxy_format=ipport&format=text&timeout=20000"
    "https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/socks4.txt"
    "https://raw.githubusercontent.com/MuRongPIG/Proxy-Master/main/socks4.txt"
    "https://raw.githubusercontent.com/mmpx12/proxy-list/master/socks4.txt"
    ### Socks 5
    "https://api.proxyscrape.com/v3/free-proxy-list/get?request=getproxies&protocol=socks5&proxy_format=ipport&format=text&timeout=20000"
    "https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/socks5.txt"
    "https://raw.githubusercontent.com/MuRongPIG/Proxy-Master/main/socks5.txt"
    "https://raw.githubusercontent.com/hookzof/socks5_list/master/proxy.txt"
    "https://raw.githubusercontent.com/mmpx12/proxy-list/master/socks5.txt"
)

rm -f /tmp/proxies 2> /dev/null
filefetch() {
    if [[ "$1" == *"socks5"* ]]; then
        prefixlist="socks5://"
    elif [[ "$1" == *"socks4"* ]]; then
        prefixlist="socks4://"
    else
        prefixlist="http://"
    fi
    cat "$1" | while IFS= read -r line; do echo "$prefixlist$line"; done >> /tmp/proxies
}
[[ -f "$HOME/.cache/socks4.txt" ]] && filefetch "$HOME/.cache/socks4.txt" && cat "$HOME/.cache/socks4.txt" >> /tmp/proxies
[[ -f "$HOME/.cache/socks5.txt" ]] && filefetch "$HOME/.cache/socks5.txt" && cat "$HOME/.cache/socks5.txt" >> /tmp/proxies
[[ -f "$HOME/.cache/http.txt" ]] && filefetch "$HOME/.cache/http.txt" && cat "$HOME/.cache/http.txt" >> /tmp/proxies
rm -f "$HOME/.cache/socks4.txt" 2> /dev/null
rm -f "$HOME/.cache/socks5.txt" 2> /dev/null
rm -f "$HOME/.cache/http.txt" 2> /dev/null
rm -f "$HOME/.cache/proxylist.txt" 2> /dev/null
urlfetch() {
    if [[ $1 == *"socks5"* ]]; then
        prefix="socks5://"
    elif [[ $1 == *"socks4"* ]]; then
        prefix="socks4://"
    else
        prefix="http://"
    fi
    curl -s "$1" | while IFS= read -r line; do echo "$prefix$line"; done >> /tmp/proxies
}
for url in "${urls[@]}"; do
    urlfetch "$url"
done
proxies=$(wc --lines < /tmp/proxies | awk '{print $1}')
counter=0
rm -f /tmp/proxy-counter.txt
tac /tmp/proxies | awk '!seen[$0]++' | tac > /tmp/proxies_clean && mv /tmp/proxies_clean /tmp/proxies # clean repeated ip:port from bottom
while IFS= read -r line; do
    ((counter++)) && echo "$counter" > /tmp/proxy-counter.txt
    proxytest "${line}" &
done < /tmp/proxies
